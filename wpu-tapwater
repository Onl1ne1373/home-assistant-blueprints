blueprint:
  name: Tapwater
  description: 
  domain: automation
  input:
    mqtt_topic:
      name: MQTT Command Topic
      description: 
      default: itho/cmd
    schedule:
      name: Schedule
      description: A time schedule to disable tapwater heating
      selector:
        entity:
          domain:
          - schedule
          multiple: false
    schedule_active:
      name: Schedule active
      description: This must be a switch/input_boolean helper. With this you can disable the schedule without removing all scheduled parts.
      selector:
        entity:
          domain:
          - input_boolean
          multiple: false
    eco_active:
      name: Eco active
      description: This must be a switch/input_boolean helper. Changed by the schedule. With this you can manually change the current state.
      selector:
        entity:
          domain:
          - input_boolean
          multiple: false
  source_url: https://raw.githubusercontent.com/Onl1ne1373/home-assistant-blueprints/main/wpu-tapwater.yaml
trigger:
- platform: state
  entity_id: !input schedule
  id: schedule_changed
variables:

condition:
action:
- choose:
  - alias: Schedule changed, change if schedule active
    conditions:
    - condition: trigger
      id:
      - schedule_changed
    - condition: template
      value_template: "{{ trigger.to_state.state in ['on', 'off'] }}"
    - condition: state
      entity_id: !input schedule_active
      state: "on"
    sequence:
    - service: input_boolean.turn_{{ trigger.to_state.state }}
      data: {}
      target:
        entity_id: input_boolean.warmtepomp_tapwater_eco

mode: queued
trace:
  stored_traces: 10
